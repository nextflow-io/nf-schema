{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://nextflow.io",
  "title": "Nextflow Schema Meta-schema",
  "description": "Meta-schema to validate Nextflow parameter schema files",
  "type": "object",
  "properties": {
    "$schema": {
      "title": "schema",
      "type": "string",
      "minLength": 1
    },
    "$id": {
      "title": "ID URI",
      "type": "string",
      "minLength": 1
    },
    "title": {
      "title": "Title",
      "type": "string",
      "minLength": 1
    },
    "description": {
      "title": "Description",
      "type": "string",
      "minLength": 1
    },
    "type": {
      "title": "Top level type",
      "type": "string",
      "const": "object"
    },
    "defs": {
      "title": "Parameter groups",
      "type": "object",
      "patternProperties": {
        "^.*$": {
          "type": "object",
          "required": [
            "title",
            "type",
            "properties"
          ],
          "properties": {
            "title": {
              "type": "string",
              "minLength": 1
            },
            "type": {
              "const": "object"
            },
            "fa_icon": {
              "type": "string",
              "pattern": "^fa"
            },
            "description": {
              "type": "string"
            },
            "required": {
              "type": "array"
            },
            "dependentRequired": {
              "type": "object",
              "additionalProperties": {
                "type": "array",
                "items": { "type": "string" },
                "uniqueItems": true,
                "default": []
              }
            },
            "properties": {
              "type": "object",
              "patternProperties": {
                "^.*$": {
                    "type": "object",
                    "required": [
                      "type"
                    ],
                    "properties": {
                      "type": {
                        "anyOf": [
                          { 
                            "$ref": "#/$defs/typeAnnotation"
                          },
                          {
                            "type": "array",
                            "items": {
                              "$ref": "#/$defs/typeAnnotation"
                            }
                          }
                        ]
                      },
                      "format": {
                        "type": "string",
                        "enum": [
                          "file-path",
                          "directory-path",
                          "path",
                          "file-path-pattern",
                          "date-time",
                          "date",
                          "time",
                          "duration",
                          "email",
                          "idn-email",
                          "hostname",
                          "id-hostname",
                          "ipv4",
                          "ipv6",
                          "uuid",
                          "uri",
                          "uri-reference",
                          "iri",
                          "iri-reference",
                          "uri-template",
                          "json-pointer",
                          "regex"
                        ]
                      },
                      "exists": {
                        "type": "boolean"
                      },
                      "mimetype": {
                        "type": "string",
                        "pattern": ".+/.+"
                      },
                      "pattern": {
                        "type": "string",
                        "format": "regex",
                        "minLength": 1
                      },
                      "schema": {
                        "type": "string",
                        "minLength": 1
                      },
                      "description": {
                        "type": "string"
                      },
                      "help_text": {
                        "type": "string"
                      },
                      "fa_icon": {
                        "type": "string",
                        "pattern": "^fa"
                      },
                      "errorMessage": {
                        "type": "string",
                        "minLength": 1
                      },
                      "default": {
                        "$ref": "#/$def/allTypes"
                      },
                      "examples": {
                        "type": "array",
                        "items": {
                          "$ref": "#/$def/allTypes"
                        }
                      },
                      "deprecated": {
                        "type": "boolean"
                      },
                      "hidden": {
                        "type": "boolean"
                      },
                      "minLength": {
                        "$ref": "#/$def/nonNegativeInteger"
                      },
                      "maxLength": {
                        "$ref": "#/$def/nonNegativeInteger"
                      },
                      "minimum": {
                        "type": "number"
                      },
                      "exclusiveMinimum": {
                        "type": "number"
                      },
                      "maximum": {
                        "type": "number"
                      },
                      "exclusiveMaximum": {
                        "type": "number"
                      },
                      "multipleOf": {
                        "type": "number"
                      },
                      "enum": {
                        "type": "array",
                        "uniqueItems": true,
                        "items": {
                          "$ref": "#/$def/allTypes"
                        }
                      },
                      "const": {
                        "$ref": "#/$def/allTypes"
                      }
                    }
                  }
                }
              }
            }
          }
        }
    },
    "allOf": {
      "title": "Combine definition groups",
      "type": "array",
      "items": {
        "type": "object",
        "required": [
          "$ref"
        ],
        "properties": {
          "$ref": {
            "type": "string",
            "pattern": "^#/defs/"
          }
        }
      }
    }
  },
  "required": [
    "$schema",
    "$id",
    "title",
    "description",
    "type"
  ],
  "$defs": {
    "typeAnnotation": {
      "type": "string",
      "enum": [
        "string",
        "boolean",
        "integer",
        "number",
        "null"
      ]
    },
    "allTypes": {
      "type": ["integer", "boolean", "number", "string", "null"]
    },
    "nonNegativeInteger": {
      "type": "integer",
      "minimum": 0
    }
  }
}
